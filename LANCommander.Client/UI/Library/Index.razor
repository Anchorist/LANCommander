@page "/"
@using LANCommander.Client.Models
@inject SDK.Client Client
@inject NavigationManager NavigationManager
@inject LibraryService LibraryService

<GridRow>
    <GridCol Span="6">
        <Collapse>
            @foreach (var collection in LibraryItems.Where(i => i.DataItem is Data.Models.Collection))
            {
                <Panel Header="@collection.Name" Key="@collection.Key.ToString()">
                    <AntList DataSource="@collection.Children" TItem="LibraryItem" Size="small">
                        <ListItem OnClick="() => OnLibraryItemSelected(context)">
                            @context.Name
                        </ListItem>
                    </AntList>
                </Panel>
            }
        </Collapse>
    </GridCol>
    <GridCol Span="18">
        
    </GridCol>
</GridRow>

@code {
    Data.Models.Game SelectedGame { get; set; }

    IEnumerable<LibraryItem> LibraryItems { get; set; }

    protected override async Task OnInitializedAsync()
    {
        LibraryItems = await LibraryService.GetLibraryItemsAsync();
    }

    async Task OnLibraryItemSelected(LibraryItem item)
    {
        if (item.DataItem is Data.Models.Game)
            SelectedGame = item.DataItem as Data.Models.Game;
    }

    async void Import()
    {
        await LibraryService.ImportAsync();
    }
}
